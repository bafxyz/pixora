# Роль: Admin (Супер-администратор)

## Описание роли
Admin - это роль супер-администратора платформы Pixora с полным доступом ко всем функциям и данным системы. Эта роль предназначена для владельцев платформы и технических администраторов.

## Права доступа

### Полный доступ к системе
- ✅ Управление всеми клиентами (студиями)
- ✅ Создание и удаление клиентов
- ✅ Просмотр статистики всей платформы
- ✅ Доступ ко всем фотографиям и заказам
- ✅ Управление всеми пользователями
- ✅ Настройка системных параметров
- ✅ Доступ к логам и мониторингу

### Доступные страницы
- `/admin` - Панель администратора платформы
- `/studio-admin` - Доступ к панели студийного администратора
- `/photographer` - Доступ к панели фотографа
- `/dashboard` - Главная панель управления
- `/session/*` - Просмотр всех фотосессий

### API Endpoints

#### Эксклюзивные для Admin
- `GET /api/admin/stats` - Статистика платформы
- `GET /api/admin/clients` - Список всех клиентов
- `POST /api/admin/clients` - Создание нового клиента
- `DELETE /api/admin/clients/[id]` - Удаление клиента
- `PATCH /api/admin/clients/[id]` - Обновление данных клиента

#### Доступ к endpoints других ролей
- Все endpoints для `studio-admin`
- Все endpoints для `photographer`
- Все endpoints для `guest`

## Функциональные возможности

### 1. Управление клиентами
```typescript
// Просмотр всех клиентов платформы
interface ClientData {
  id: string
  name: string
  subdomain: string
  status: 'active' | 'suspended' | 'trial'
  createdAt: Date
  photographersCount: number
  guestsCount: number
  photosCount: number
  ordersCount: number
  revenue: number
}
```

### 2. Статистика платформы
- Общее количество клиентов
- Общее количество фотографов
- Общее количество гостей
- Общее количество загруженных фото
- Общая выручка платформы
- Активность по дням/месяцам
- Топ клиентов по выручке

### 3. Системные настройки
- Настройка тарифных планов
- Управление лимитами хранилища
- Настройка сроков хранения фото
- Управление интеграциями
- Настройка email шаблонов

### 4. Мониторинг и логи
- Просмотр логов безопасности
- Мониторинг производительности
- Отслеживание ошибок
- Аудит действий пользователей

## Интерфейс администратора

### Компоненты страницы `/admin`
1. **Dashboard с метриками**
   - Карточки с ключевыми показателями
   - Графики роста
   - Таблица последних событий

2. **Управление клиентами**
   - Таблица всех клиентов
   - Фильтры и поиск
   - Быстрые действия (активация/деактивация)
   - Детальная информация о клиенте

3. **Финансовая аналитика**
   - Общая выручка
   - Выручка по клиентам
   - Прогнозы и тренды
   - Экспорт отчетов

## Безопасность

### Аутентификация
- Обязательная двухфакторная аутентификация
- Сессии с ограниченным сроком действия
- IP whitelist (опционально)

### Проверки доступа
```typescript
// Каждый API endpoint проверяет роль
const auth = await withRoleCheck(['admin'], request)
if (auth instanceof NextResponse) {
  return auth // 403 Forbidden
}
```

### Логирование действий
Все действия администратора логируются:
- Создание/удаление клиентов
- Изменение настроек
- Доступ к конфиденциальным данным
- Экспорт данных

## Ограничения

### Что НЕ может делать Admin
- ❌ Напрямую изменять данные в Supabase Auth
- ❌ Удалять системные таблицы
- ❌ Изменять код приложения через интерфейс

### Рекомендации по безопасности
1. Минимальное количество пользователей с ролью Admin
2. Регулярная ротация паролей
3. Использование VPN для доступа
4. Регулярный аудит действий
5. Разделение ролей (не совмещать Admin с другими ролями)

## Типичные сценарии использования

### 1. Онбординг нового клиента
```
1. Admin создает нового клиента через /admin
2. Система генерирует subdomain
3. Admin создает studio-admin аккаунт для клиента
4. Отправляет приглашение по email
5. Настраивает лимиты и тарифный план
```

### 2. Разрешение проблем
```
1. Получение жалобы от клиента
2. Просмотр логов и данных клиента
3. Идентификация проблемы
4. Исправление данных или настроек
5. Уведомление клиента о решении
```

### 3. Мониторинг платформы
```
1. Ежедневный просмотр dashboard
2. Проверка аномалий в метриках
3. Анализ производительности
4. Реагирование на критические события
5. Подготовка отчетов для руководства
```

## Техническая реализация

### Middleware защита
```typescript
// middleware.ts
if (pathname.startsWith('/admin')) {
  const userRole = user?.user_metadata?.role
  if (userRole !== 'admin') {
    return redirectToLogin(request)
  }
}
```

### API защита
```typescript
// Все admin API endpoints
export async function GET(request: NextRequest) {
  const auth = await withRoleCheck(['admin'], request)
  if (auth instanceof NextResponse) return auth

  // Безопасное выполнение операций
  const stats = await getGlobalStats()
  return NextResponse.json(stats)
}
```

## Миграция и обновления

### При обновлении системы
1. Admin получает уведомление о планируемом обновлении
2. Может временно ограничить доступ другим пользователям
3. Проводит тестирование после обновления
4. Восстанавливает полный доступ

### Резервное копирование
Admin имеет доступ к:
- Экспорту всех данных платформы
- Созданию точек восстановления
- Восстановлению из резервных копий

## Контакты и поддержка

### Для Admin доступна
- Прямая линия технической поддержки
- Приоритетное решение проблем
- Доступ к документации для разработчиков
- Участие в планировании развития платформы

---

**Важно**: Роль Admin имеет критическое значение для безопасности всей платформы. Необходимо строго контролировать доступ и регулярно проводить аудит действий администраторов.