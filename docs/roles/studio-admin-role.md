# Роль: Studio Admin (Администратор студии)

## Описание роли
Studio Admin - это роль администратора фотостудии в системе Pixora. Управляет всеми аспектами работы своей студии: фотографами, фотосессиями, заказами и настройками. Имеет доступ только к данным своего клиента (студии).

## Права доступа

### Управление студией
- ✅ Создание и управление фотографами
- ✅ Просмотр всех фотосессий студии
- ✅ Управление гостями и клиентами
- ✅ Просмотр и обработка заказов
- ✅ Настройка брендинга студии
- ✅ Просмотр финансовой статистики
- ❌ Доступ к данным других студий
- ❌ Изменение системных настроек

### Доступные страницы
- `/studio-admin` - Панель администратора студии
- `/photographer` - Доступ к функциям фотографа
- `/dashboard` - Общая панель управления
- `/session/*` - Просмотр всех фотосессий студии

### API Endpoints

#### Эксклюзивные для Studio Admin
- `GET /api/studio-admin/stats` - Статистика студии
- `GET /api/studio-admin/guests` - Список всех гостей студии
- `GET /api/studio-admin/orders` - Все заказы студии
- `POST /api/photographers` - Создание нового фотографа
- `PATCH /api/photographers/[id]` - Обновление данных фотографа
- `DELETE /api/photographers/[id]` - Удаление фотографа

#### Общие с Photographer
- `POST /api/photos/save` - Загрузка фотографий
- `POST /api/photo-sessions` - Создание фотосессии
- `POST /api/qr/generate` - Генерация QR кодов

## Функциональные возможности

### 1. Управление фотографами
```typescript
interface PhotographerManagement {
  create: {
    firstName: string
    lastName: string
    email: string
    password: string
    permissions: string[]
  }
  update: {
    active: boolean
    permissions: string[]
  }
  view: {
    stats: PhotographerStats
    sessions: PhotoSession[]
    uploadedPhotos: number
  }
}
```

### 2. Статистика студии
- Количество активных фотографов
- Общее количество гостей
- Количество фотосессий (завершенных/активных)
- Общее количество загруженных фото
- Выручка за период
- Конверсия просмотров в заказы
- Средний чек

### 3. Управление фотосессиями
```typescript
interface SessionManagement {
  // Просмотр всех сессий студии
  viewAll(): PhotoSession[]

  // Назначение фотографа на сессию
  assignPhotographer(sessionId: string, photographerId: string): void

  // Изменение статуса сессии
  updateStatus(sessionId: string, status: SessionStatus): void

  // Массовые операции
  bulkDelete(sessionIds: string[]): void
  bulkArchive(sessionIds: string[]): void
}
```

### 4. Обработка заказов
- Просмотр всех заказов студии
- Изменение статуса заказов
- Управление ценами и пакетами
- Экспорт заказов для бухгалтерии
- Отправка уведомлений клиентам

### 5. Настройки брендинга
- Загрузка логотипа студии
- Настройка цветовой схемы
- Кастомизация email шаблонов
- Настройка водяных знаков
- Персонализация галереи клиентов

## Интерфейс Studio Admin

### Компоненты страницы `/studio-admin`

#### 1. Dashboard
```typescript
interface StudioDashboard {
  metrics: {
    todaysSessions: number
    weeklyRevenue: number
    activePhotographers: number
    pendingOrders: number
  }
  charts: {
    revenueByDay: ChartData
    sessionsByPhotographer: ChartData
    popularPackages: ChartData
  }
  recentActivity: ActivityLog[]
}
```

#### 2. Управление командой
- Таблица фотографов с статусами
- Форма добавления нового фотографа
- Статистика по каждому фотографу
- График загруженности

#### 3. Финансы
- Общая выручка
- Выручка по фотографам
- Выручка по типам услуг
- Неоплаченные заказы
- Экспорт отчетов

## Ограничения по client_id

### Изоляция данных
Все запросы Studio Admin автоматически фильтруются по `client_id`:

```typescript
// API endpoint пример
export async function GET(request: NextRequest) {
  const auth = await withRoleCheck(['studio-admin', 'admin'], request)
  if (auth instanceof NextResponse) return auth

  // Автоматическая фильтрация по client_id
  const guests = await prisma.guest.findMany({
    where: {
      clientId: auth.clientId // Только гости этой студии
    }
  })

  return NextResponse.json(guests)
}
```

### Проверки безопасности
1. **При создании ресурсов** - автоматически присваивается client_id студии
2. **При чтении данных** - фильтрация по client_id
3. **При обновлении** - проверка принадлежности ресурса
4. **При удалении** - только ресурсы своей студии

## Типичные сценарии использования

### 1. Подготовка к мероприятию
```
1. Создание новой фотосессии
2. Назначение фотографа
3. Генерация QR кодов для гостей
4. Настройка цен и пакетов
5. Подготовка брендированных материалов
```

### 2. Управление командой
```
1. Просмотр загруженности фотографов
2. Распределение сессий между фотографами
3. Контроль качества загруженных фото
4. Анализ производительности
5. Мотивация на основе статистики
```

### 3. Работа с заказами
```
1. Мониторинг новых заказов
2. Обработка оплат
3. Подготовка фото к выдаче
4. Отправка готовых заказов
5. Работа с возвратами/жалобами
```

## Интеграции

### Email уведомления
Studio Admin может настроить автоматические уведомления:
- Новый заказ
- Фото готовы к просмотру
- Напоминание о неоплаченном заказе
- Срок хранения фото истекает

### Экспорт данных
Доступные форматы экспорта:
- CSV - для Excel
- PDF - для отчетов
- JSON - для интеграций

## Безопасность

### Двухуровневая защита
1. **Проверка роли** - studio-admin или admin
2. **Проверка client_id** - доступ только к своей студии

### Аудит действий
Логируются критические операции:
- Создание/удаление фотографов
- Изменение цен
- Массовые операции с фото
- Экспорт данных

## Отличия от роли Photographer

| Функция | Studio Admin | Photographer |
|---------|-------------|--------------|
| Загрузка фото | ✅ Все сессии | ✅ Свои сессии |
| Просмотр заказов | ✅ Все заказы | ✅ Свои заказы |
| Управление фотографами | ✅ | ❌ |
| Финансовая статистика | ✅ Полная | ⚠️ Ограниченная |
| Настройки студии | ✅ | ❌ |
| Создание фотосессий | ✅ Для любого фотографа | ✅ Только для себя |

## Рекомендации по использованию

### Best Practices
1. **Регулярный мониторинг** - проверка dashboard минимум раз в день
2. **Делегирование** - распределение задач между фотографами
3. **Автоматизация** - настройка автоматических уведомлений
4. **Резервирование** - регулярный экспорт важных данных
5. **Обучение команды** - инструктаж новых фотографов

### Частые ошибки
- ❌ Не настроен брендинг → клиенты видят стандартный интерфейс
- ❌ Не назначен фотограф на сессию → невозможно загрузить фото
- ❌ Не настроены цены → клиенты не могут оформить заказ
- ❌ Игнорирование статистики → упущенные возможности роста

## Поддержка и обучение

### Доступные ресурсы
- Видео-туториалы по основным функциям
- База знаний с FAQ
- Чат поддержки в рабочие часы
- Ежемесячные вебинары с новыми функциями

### Контакты поддержки
- Email: support@pixora.com
- Telegram: @pixora_support
- Время ответа: до 24 часов

---

**Важно**: Studio Admin несет ответственность за работу всей студии в системе. Рекомендуется назначать на эту роль опытного сотрудника с пониманием бизнес-процессов фотостудии.